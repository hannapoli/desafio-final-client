<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: pages/AdminUsers.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: pages/AdminUsers.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { useState, useEffect } from 'react';
import { Link } from 'react-router';
import { useFetch } from '../hooks/useFetch';
import { auth } from '../firebase/firebaseConfig';
import { PopUp } from '../components/PopUp';
import { InfoList } from '../components/InfoList';
import '../components/ParcelDetails.css';
import '../components/InfoList.css';

/**
 * AdminUsers component.
 *
 * Página de listado y gestión de usuarios.
 * Permite al Administrador visualizar y
 * acceder a la edición de los usuarios del sistema.
 *
 * @component
 * @returns {JSX.Element}
 */

export const AdminUsers = () => {
    const [email, setEmail] = useState('');
    const [foundUser, setFoundUser] = useState(null);
    const [searchError, setSearchError] = useState(null);
    const [users, setUsers] = useState([]);

    const [userToDelete, setUserToDelete] = useState(null);

    const [showDeletePopup, setShowDeletePopup] = useState(false);
    const [deleteLoading, setDeleteLoading] = useState(false);
    const [deleteError, setDeleteError] = useState(null);
    const [deleteSuccess, setDeleteSuccess] = useState('');

    const { fetchData, loading } = useFetch();
    const backendUrl = import.meta.env.VITE_BACKEND_URL;

    //Mostrar todos los usuarios al cargar la página
    useEffect(() => {
        const loadUsers = async () => {
            try {
                const token = await auth.currentUser?.getIdToken();
                const response = await fetchData(
                    `${backendUrl}/admin/users/getall`,
                    'GET',
                    null,
                    token
                );
                setUsers(response.users || []);
            } catch (error) {
                console.error('Error al cargar usuarios:', error);
            }
        };
        loadUsers();
    }, [backendUrl, fetchData]);


    const handleSearch = async (e) => {
        e.preventDefault();
        setSearchError(null);
        setFoundUser(null);

        if (!email.trim()) {
            setSearchError('Ingresa un email');
            return;
        }

        try {
            const token = await auth.currentUser?.getIdToken();
            const response = await fetchData(
                `${backendUrl}/admin/users/get/${email}`,
                'GET',
                null,
                token
            );
            // console.log(response.user)
            setFoundUser(response.user);

        } catch (error) {
            setSearchError(error.message || 'Usuario no encontrado');
        }
    };

    const handleDeleteUser = async () => {
        if (!userToDelete) return;
        setDeleteLoading(true);
        setDeleteError(null);
        setDeleteSuccess('');
        try {
            const token = await auth.currentUser?.getIdToken();
            await fetchData(
                `${backendUrl}/admin/users/delete/${userToDelete.firebase_uid_user}`,
                'DELETE',
                null,
                token
            );
            setShowDeletePopup(false);
            setUsers(users.filter(user => user.firebase_uid_user !== userToDelete.firebase_uid_user));
            if (foundUser?.firebase_uid_user === userToDelete.firebase_uid_user)
                setFoundUser(null);
            setEmail('');
            setUserToDelete(null);
            setDeleteSuccess('Se ha eliminado el usuario correctamente.');
        } catch (error) {
            setDeleteError(error.message || 'Error al eliminar el usuario');
        } finally {
            setDeleteLoading(false);
        }
    };

    const openDeletePopup = (user) => {
        setUserToDelete(user);
        setShowDeletePopup(true);
    };

    return (
        &lt;>
            &lt;section className='flexColumn centeredContent'>
                &lt;h1>Gestión de usuarios&lt;/h1>

                &lt;form onSubmit={handleSearch} className='flexColumn centeredContent form-get-users'>
                    &lt;div className='flexColumn'>
                        &lt;label htmlFor='email'>Buscar usuario por email:&lt;/label>
                        &lt;input
                            type='email'
                            id='email'
                            placeholder='Escribe el email del usuario...'
                            value={email}
                            onChange={(e) => setEmail(e.target.value)}
                            noValidate
                            className='register-input search-input'
                        />
                    &lt;/div>
                    &lt;button type='submit' disabled={loading} className='register-btn'>
                        {loading ? 'Buscando...' : 'Buscar'}
                    &lt;/button>
                &lt;/form>

                {deleteSuccess &amp;&amp; &lt;p className='successMessage'>{deleteSuccess}&lt;/p>}
                {searchError &amp;&amp; &lt;p className='errorMessage'>{searchError}&lt;/p>}
                {foundUser &amp;&amp; (
                    &lt;article className='flexColumn centeredContent found-card'>
                        &lt;h2 className='margin-block'>Información del usuario encontrado:&lt;/h2>
                        &lt;div className='itemInfo found-user'>
                            &lt;h3 className='user-name'>{foundUser.name_user}&lt;/h3>
                            &lt;p>&lt;span className='bold'>UID:&lt;/span> {foundUser.firebase_uid_user}&lt;/p>
                            &lt;p>&lt;span className='bold'>Email:&lt;/span> {foundUser.email_user}&lt;/p>
                            &lt;p>&lt;span className='bold'>Role:&lt;/span> {foundUser.rol_type}&lt;/p>

                            &lt;div className='userManagementActions'>
                                &lt;Link to={`/admin/users/edit/${foundUser.firebase_uid_user}`} state={{ user: foundUser }}>
                                    &lt;button className='edit-btn'>Modificar&lt;/button>
                                &lt;/Link>
                                &lt;button onClick={() => openDeletePopup(foundUser)} className='delete-btn'>Eliminar&lt;/button>
                            &lt;/div>
                        &lt;/div>
                    &lt;/article>
                )}
                &lt;h2 className='margin-block'>Lista de todos los usuarios:&lt;/h2>
                &lt;section className='userList'>
                    {loading &amp;&amp; &lt;p>Cargando usuarios...&lt;/p>}
                    {users.length === 0 &amp;&amp; !loading &amp;&amp; &lt;p>No hay usuarios registrados.&lt;/p>}
                    {users.map((user) => (
                        &lt;InfoList
                            key={user.firebase_uid_user}
                            itemObject={user}
                            stateObject={{ user: user }}
                            onModifyPath={`/admin/users/edit/${user.firebase_uid_user}`}
                            onDelete={openDeletePopup}
                        />
                    ))}
                &lt;/section>
            &lt;/section>

            {/* Popup para eliminar el usuario seleccionado */}
            &lt;PopUp
                isOpen={showDeletePopup &amp;&amp; userToDelete !== null}
                onClose={() => {
                    setShowDeletePopup(false);
                    setUserToDelete(null);
                    setDeleteError(null);
                }}
            >
                &lt;h2 className="text-green centeredText">¿Eliminar este usuario?&lt;/h2>
                {userToDelete &amp;&amp; (
                    &lt;p className="text-dark centeredText user-delete">{userToDelete.email_user}&lt;/p>
                )}
                {deleteError &amp;&amp; &lt;p className='errorMessage'>{deleteError}&lt;/p>}
                &lt;div className='flexContainer'>
                    &lt;button
                        onClick={handleDeleteUser}
                        className='edit-btn'
                        disabled={deleteLoading}
                    >
                        {deleteLoading ? 'Eliminando...' : 'Sí, eliminar'}
                    &lt;/button>
                    &lt;button
                        className='delete-btn'
                        onClick={() => {
                            setShowDeletePopup(false);
                            setUserToDelete(null);
                            setDeleteError(null);
                        }}
                        disabled={deleteLoading}
                    >
                        Cancelar
                    &lt;/button>
                &lt;/div>
            &lt;/PopUp>
        &lt;/>
    );
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-contexts_AuthProvider.html">contexts/AuthProvider</a></li><li><a href="module-helpers_firebaseErrorMessages.html">helpers/firebaseErrorMessages</a></li><li><a href="module-hooks_useFetch.html">hooks/useFetch</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AddParcel">AddParcel</a></li><li><a href="global.html#AdminDashboard">AdminDashboard</a></li><li><a href="global.html#AdminLayout">AdminLayout</a></li><li><a href="global.html#AdminNav">AdminNav</a></li><li><a href="global.html#AdminUserEdit">AdminUserEdit</a></li><li><a href="global.html#AdminUsers">AdminUsers</a></li><li><a href="global.html#AnalystDashboard">AnalystDashboard</a></li><li><a href="global.html#AnalystLayout">AnalystLayout</a></li><li><a href="global.html#AnaystNav">AnaystNav</a></li><li><a href="global.html#AppRoutes">AppRoutes</a></li><li><a href="global.html#AuthContext">AuthContext</a></li><li><a href="global.html#AuthLayout">AuthLayout</a></li><li><a href="global.html#ChatBot">ChatBot</a></li><li><a href="global.html#ClickablePolygon">ClickablePolygon</a></li><li><a href="global.html#ConsultantDashboard">ConsultantDashboard</a></li><li><a href="global.html#ConsultantFields">ConsultantFields</a></li><li><a href="global.html#ConsultantLayout">ConsultantLayout</a></li><li><a href="global.html#ConsultantNav">ConsultantNav</a></li><li><a href="global.html#ConsultantReports">ConsultantReports</a></li><li><a href="global.html#ConsultantSeeProducerFields">ConsultantSeeProducerFields</a></li><li><a href="global.html#DirectorConsultants">DirectorConsultants</a></li><li><a href="global.html#DirectorDashboard">DirectorDashboard</a></li><li><a href="global.html#DirectorFields">DirectorFields</a></li><li><a href="global.html#DirectorLayout">DirectorLayout</a></li><li><a href="global.html#DirectorNav">DirectorNav</a></li><li><a href="global.html#DirectorReports">DirectorReports</a></li><li><a href="global.html#Disease">Disease</a></li><li><a href="global.html#DistributorDashboard">DistributorDashboard</a></li><li><a href="global.html#DistributorLayout">DistributorLayout</a></li><li><a href="global.html#DistributorNav">DistributorNav</a></li><li><a href="global.html#FieldInfo">FieldInfo</a></li><li><a href="global.html#FilterParcelForm">FilterParcelForm</a></li><li><a href="global.html#Legend">Legend</a></li><li><a href="global.html#LoginPage">LoginPage</a></li><li><a href="global.html#Map">Map</a></li><li><a href="global.html#MapsContext">MapsContext</a></li><li><a href="global.html#MenuCard">MenuCard</a></li><li><a href="global.html#NavContext">NavContext</a></li><li><a href="global.html#ParcelDetails">ParcelDetails</a></li><li><a href="global.html#PrivateRoutes">PrivateRoutes</a></li><li><a href="global.html#ProducerDashboard">ProducerDashboard</a></li><li><a href="global.html#ProducerLayout">ProducerLayout</a></li><li><a href="global.html#ProducerNav">ProducerNav</a></li><li><a href="global.html#ProducerReports">ProducerReports</a></li><li><a href="global.html#ProducerSeeFields">ProducerSeeFields</a></li><li><a href="global.html#Report">Report</a></li><li><a href="global.html#VegetationIndex">VegetationIndex</a></li><li><a href="global.html#ViewerParcelProducer">ViewerParcelProducer</a></li><li><a href="global.html#ViewerPopup">ViewerPopup</a></li><li><a href="global.html#firebaseConfig">firebaseConfig</a></li><li><a href="global.html#normalizeFileData">normalizeFileData</a></li><li><a href="global.html#options">options</a></li><li><a href="global.html#useAuth">useAuth</a></li><li><a href="global.html#useChatSocket">useChatSocket</a></li><li><a href="global.html#useNav">useNav</a></li><li><a href="global.html#userMap">userMap</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Thu Jan 29 2026 15:34:36 GMT+0100 (hora estándar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
